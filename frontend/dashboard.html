<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî ShopAnalytics</title>
    <!-- –¢–µ –∂–µ —Å—Ç–∏–ª–∏, –∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
    <link rel="stylesheet" href="./css/fonts.css" />
    <link rel="stylesheet" href="./css/globals.css" />
    <link rel="stylesheet" href="./css/variables.css" />
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/dark.css" />
    <link rel="stylesheet" href="./css/light.css" />
    <!-- Chart.js –¥–ª—è –±—É–¥—É—â–∏—Ö —á–∞—Ä—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="page">
    <!-- Layout ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≥–ª–∞–≤–Ω–æ–π -->
    <div class="page-layout">
        <!-- –•–µ–¥–µ—Ä ‚Äî –ø–æ—Ö–æ–∂–∏–π, –Ω–æ —Å "–ì–ª–∞–≤–Ω–∞—è" –∏ "–í—ã–π—Ç–∏" -->
        <header class="header">
            <div class="wrapper flexbox middle">
                <a href="/" class="logotype">
                    <img src="./images/logo.png" alt="Logo" class="logotype__img">
                    <span>ShopAnalytics</span>
                </a>
                <nav class="menu">
                    <a href="/">–ì–ª–∞–≤–Ω–∞—è</a> <!-- –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é -->
                    <a href="#reports" onclick="showPage('reports-page')">–û—Ç—á—ë—Ç—ã</a>
                    <a href="#settings" onclick="showPage('settings-page')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                </nav>
                <div class="header-actions flexbox" style="gap: 1em;">
                    <button id="logoutBtn" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
                </div>
                <button class="mobile-toggle" aria-label="–ú–µ–Ω—é">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </header>
        <!-- Hero + –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="hero">
            <div class="cosmic-bg">
                <div class="stars"></div>
                <div class="stars2"></div>
                <div class="stars3"></div>
                <div class="background-planet"></div>
                <div class="mars-rings-front"></div>
                <div class="mars-rings"></div>
            </div>
            <div class="wrapper-hero">
                <div class="wrapper">
                    <div class="h_part">
                        <div class="h1_box h_part">
                            <h1 class="h5" data-text="–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                            <p id="userName" class="header__paragraph" style="font-size: 1.6em; color: var(--gray); max-width: 50ch; margin: 1.5em 0;"></p>
                        </div>
                        <!-- –§–æ—Ä–º–∞ –ø—Ä–æ—Ñ–∏–ª—è (–≤–≤–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ) -->
                        <div id="profileFormSection" class="profile-form-section mb-6">
                            <!-- –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è JS: DashboardView(userData) -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π, –Ω–æ –¥–ª—è 1 —Å—Ç—Ä–æ–∫–∏) -->
            <section id="personalResults" class="results-section">
                <div class="wrapper">
                    <div class="section-header flexbox middle">
                        <h2>–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    </div>
                    <!-- –°–≤–æ–¥–∫–∞ (placeholders –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞) -->
                    <div id="personalSummary" class="summary-cards">
                        <div class="card">–ü—Ä–æ–¥–∞–∂: <span id="personalSalesCount">0</span></div>
                        <div class="card">–í—ã—Ä—É—á–∫–∞: <span id="personalRevenue">0 ‚ÇΩ</span></div>
                        <div class="card">–ü—Ä–∏–±—ã–ª—å: <span id="personalProfit">0 ‚ÇΩ</span></div>
                    </div>
                    <!-- –¢–∞–±–ª–∏—Ü–∞ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è, 1 —Å—Ç—Ä–æ–∫–∞) -->
                    <div class="table-container">
                        <table id="personalReportTable" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>–ü—Ä–æ–¥–∞–≤–µ—Ü</th>
                                    <th>–í—ã—Ä—É—á–∫–∞</th>
                                    <th>–ü—Ä–∏–±—ã–ª—å</th>
                                    <th>–ü—Ä–æ–¥–∞–∂</th>
                                    <th>KPI</th>
                                    <th>–ë–æ–Ω—É—Å</th>
                                    <th>–¢–æ–ø-—Ç–æ–≤–∞—Ä—ã</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="personalSellerTableBody">
                                <!-- –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è JS: 1 —Å—Ç—Ä–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                            </tbody>
                        </table>
                    </div>
                    <!-- –¢–æ–ø-—Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                    <div id="personalTopProductsSection">
                        <!-- –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è JS -->
                    </div>
                </div>
            </section>
        </main>
    </div>
    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
   <script type="module">
    import { initDashboard } from "./src/modules/dashboard.js";

    // –ó–∞–≥–ª—É—à–∫–∏
    window.showPage = function(pageId) { console.log(`–ù–∞–≤–∏–≥–∞—Ü–∏—è: ${pageId}`); };

    // INLINE logout —Å –¥–µ–±–∞–≥–∞–º–∏
    function logout() {
        console.log('üîì Logout function called'); // –õ–æ–≥: –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
        localStorage.removeItem("userId");
        console.log('üîì userId removed from localStorage'); // –õ–æ–≥: —É–¥–∞–ª–µ–Ω–∏–µ
        window.location.href = "/"; // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        console.log('üîì Redirect to / initiated'); // –õ–æ–≥: —Ä–µ–¥–∏—Ä–µ–∫—Ç (–º–æ–∂–µ—Ç –Ω–µ –¥–æ–π—Ç–∏)
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ Dashboard DOMContentLoaded fired'); // –õ–æ–≥: DOM –≥–æ—Ç–æ–≤

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–í—ã–π—Ç–∏" —Å –¥–µ–±–∞–≥–∞–º–∏
        const logoutBtn = document.getElementById("logoutBtn");
        console.log('üîç Logout button found:', logoutBtn); // –õ–æ–≥: –∫–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞?
        if (logoutBtn) {
            logoutBtn.addEventListener("click", (e) => {
                e.preventDefault();
                console.log('üîì Click on logout detected'); // –õ–æ–≥: –∫–ª–∏–∫
                logout(); // –í—ã–∑–æ–≤
            });
        } else {
            console.error('‚ùå #logoutBtn not found ‚Äî check ID in HTML'); // –ï—Å–ª–∏ null
        }

        // Fallback: onclick –Ω–∞ –∫–Ω–æ–ø–∫–µ (–µ—Å–ª–∏ listener –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
        const fallbackBtn = document.querySelector('#logoutBtn'); // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        if (fallbackBtn) {
            fallbackBtn.onclick = logout; // –ü—Ä—è–º–æ–π onclick
            console.log('üîç Fallback onclick added to logoutBtn');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–∞
        const userId = localStorage.getItem("userId");
        console.log('üîç Dashboard userId:', userId); // –õ–æ–≥: ID
        const profileRoot = document.getElementById("profileFormSection");
        const summaryRoot = document.getElementById("personalSummary");
        if (userId) {
            initDashboard(parseInt(userId), profileRoot, summaryRoot);
        } else {
            console.warn('‚ö† No userId in dashboard ‚Äî redirecting');
            window.location.href = "/";
        }
    });
</script>
</body>
</html>