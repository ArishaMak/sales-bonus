<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self' https:;
        script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net;
        font-src 'self' https://fonts.gstatic.com https://r2cdn.perplexity.ai data:;
        img-src 'self' data: blob: https:;
        connect-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://api.example.com;
      ">

    <!-- Удалён meta CSP — используй server CSP, чтобы не блокировать CDN/fonts -->
    <title>Анализ продаж магазина</title>
    <link rel="stylesheet" href="./css/fonts.css" />
    <link rel="stylesheet" href="./css/globals.css" />
    <link rel="stylesheet" href="./css/variables.css" />
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/dark.css" />
    <link rel="stylesheet" href="./css/light.css" />
    <!-- Chart.js CDN в head -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="page">
    <!-- Layout -->
    <div class="page-layout">
        <!-- Хедер -->
        <header class="header">
            <div class="wrapper flexbox middle">
                <a href="/" class="logotype">
                    <img src="../images/logo.png" alt="Logo" class="logotype__img">
                    <span>ShopAnalytics</span>
                </a>
                <nav class="menu">
                    <a href="#dashboard" onclick="showPage('dashboard-page')">Дашборд</a>
                    <a href="#reports" onclick="showPage('reports-page')">Отчёты</a>
                    <a href="#settings" onclick="showPage('settings-page')">Настройки</a>
                </nav>
                <div class="header-actions flexbox" style="gap: 1em;">
                    <button class="btn btn-secondary" onclick="openModal('loginModal')">Войти</button>
                    <button class="btn btn-primary" onclick="openModal('registerModal')">Регистрация</button>
                </div>
                <button class="mobile-toggle" aria-label="Меню">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </header>
        <!-- Hero + Фильтры -->
        <main class="hero">
            <div class="cosmic-bg">
                <div class="stars"></div>
                <div class="stars2"></div>
                <div class="stars3"></div>
                <div class="background-planet"></div>
                <div class="mars-rings-front"></div>
                <div class="mars-rings"></div>
            </div>
            <div class="wrapper-hero">
                <div class="wrapper">
                    <div class="h_part">
                        <div class="h1_box h_part">
                            <h1 class="h1" data-text="Анализ продаж в реальном времени">
                                Анализ продаж в реальном времени
                            </h1>
                        </div>
                        <p class="header__paragraph" style="font-size: 1.6em; color: var(--gray); max-width: 50ch; margin: 1.5em 0;">
                            Аналитика выручки, бонусов и топ-продуктов по продавцам. Фильтруйте, ищите, экспортируйте.
                        </p>
                        <div>
                            <a href="#filters" class="btn btn-primary">Начать анализ</a>
                        </div>
                    </div>
                    <!-- Фильтры -->
                    <section id="filters" class="filters-panel">
                        <div class="filter-group">
                            <input type="text" id="search" placeholder="Поиск по продавцу или покупателю" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <select id="sellerFilter" class="filter-select"></select>
                        </div>
                        <div class="filter-group">
                            <select id="skuFilter" class="filter-select"></select>
                        </div>
                        <div class="filter-group">
                            <button id="applyFilters" class="btn btn-primary">Применить</button>
                            <button id="resetFilters" class="btn btn-secondary">Сброс</button>
                        </div>
                    </section>
                </div>
            </div>
            <!-- Результаты (анализ продавцов) -->
            <section id="results" class="results-section">
                <div class="wrapper">
                    <div class="section-header flexbox middle">
                        <h2>Результаты анализа</h2>
                        <div class="export-btn">
                            <button class="btn btn-secondary">Экспорт CSV</button>
                        </div>
                    </div>
                    <!-- Краткая сводка — с placeholders для дашборда (ИЗМЕНЕНИЕ: добавлены span с ID для dashboard.js рендера) -->
                    <div id="summary" class="summary-cards">
                        <div class="card">Продукты: <span id="totalProducts">0</span></div> <!-- ДОБАВЛЕНО: placeholder для total_products -->
                        <div class="card">Записи: <span id="totalRecords">0</span></div> <!-- ДОБАВЛЕНО: placeholder для total_records -->
                        <div class="card">Клиенты: <span id="totalCustomers">0</span></div> <!-- ДОБАВЛЕНО: placeholder для total_customers -->
                    </div>
                    <!-- Таблица -->
                    <div class="table-container">
                        <table id="reportTable" class="table table-striped">
    <thead>
        <tr>
            <!-- Убедитесь, что здесь ровно 8 колонок (<th>) -->
            <th>Продавец</th>
            <th>Выручка</th>
            <th>Прибыль</th>
            <th>Продаж</th>
            <th>KPI</th>
            <th>Бонус</th>
            <th>Топ-товары</th>
            <th>Действия</th>
        </tr>
    </thead>
    <!-- Тело таблицы будет генерироваться вашим JavaScript -->
    <tbody id="sellerTableBody">
        <!-- ... здесь вставляются строки из table.js ... -->
    </tbody>
</table>
                    </div>
                    <div id="pagination">
                        <!-- Пагинация генерируется JS -->
                    </div>
                    <!-- Топ-товары (из main.js) — ДОБАВЛЕНО: div для рендера topProductsSection -->
                    <div id="topProductsSection">
                        <!-- Генерируется JS -->
                    </div>
                </div>
            </section>
        </main>
    </div>
    <!-- Модалка продавца -->
    <div id="sellerCardModal" class="modal">
        <div class="modal-content">
            <div id="sellerCardContent">
                <!-- Рендерится JS -->
            </div>
        </div>
    </div>
    <!-- НОВОЕ: Модалка входа (Login Modal) -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Вход</h3>
                <button class="close-button" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email:</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Пароль:</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Войти</button>
            </form>
            <div id="loginMessage" style="margin-top: 1em; color: red;"></div>
        </div>
    </div>
    <!-- Модалка регистрации -->
    <!-- ДОБАВЛЕНО: style="display: none;" для скрытия по умолчанию -->
    <div id="registerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Регистрация</h3>
                <!-- ОБНОВЛЕНО: Использует closeModal() -->
                <button id="closeRegisterModal" class="close-button" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regEmail">Email:</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Password:</label>
                    <input type="password" id="regPassword" minlength="8" required>
                </div>
                <div class="form-group">
                    <label for="regName">Name:</label>
                    <input type="text" id="regName" required>
                </div>
                <button type="submit" class="btn btn-primary">Зарегистрироваться</button>
            </form>
            <div id="regMessage" style="margin-top: 1em; color: green;"></div>
        </div>
    </div>
    <script type="module" src="./src/main.js"></script>
    <!-- JavaScript для управления модальными окнами -->
    <script type="module">
        /**
         * Функция для открытия модального окна.
         * Устанавливает style.display = 'flex' для отображения.
         * @param {string} modalId - ID модального окна (например, 'registerModal').
         */
        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                // Используем flex, чтобы центрировать модалку, если это заложено в исходном CSS .modal
                // Если нет, это обеспечит хотя бы базовое отображение.
                modal.style.display = 'flex'; 
                modal.setAttribute('aria-modal', 'true');
                modal.setAttribute('role', 'dialog');
            }
        }

        /**
         * Функция для закрытия модального окна.
         * Устанавливает style.display = 'none' для скрытия.
         * @param {string} modalId - ID модального окна.
         */
        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                modal.removeAttribute('aria-modal');
                modal.removeAttribute('role');
            }
        }

        // --- Заглушки для других функций, чтобы избежать ошибок ---

        // Заглушка для функции навигации
        window.showPage = function(pageId) {
            console.log(`Навигация к странице: ${pageId}`);
            // В реальном приложении здесь будет логика переключения вкладок
        }

        // Заглушка для функции открытия карточки продавца
        window.openSellerCard = function(sellerData) {
            console.log('Открытие карточки продавца:', sellerData);
            const content = document.getElementById('sellerCardContent');
            if (content) {
                content.innerHTML = `<p>Детали продавца ${sellerData.name} будут здесь.</p>`;
            }
            openModal('sellerCardModal');
        }

        // Дополнительные обработчики для закрытия по клику вне модалки
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    // Закрываем, только если клик был непосредственно по фону модалки (modal)
                    if (e.target.id === modal.id) {
                        closeModal(modal.id);
                    }
                });
            });

            // Заглушки для отправки форм
            document.getElementById('loginForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                document.getElementById('loginMessage').textContent = 'Вход (имитация).';
                console.log('Login attempt');
            });
            document.getElementById('registerForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                document.getElementById('regMessage').textContent = 'Регистрация успешна (имитация).';
                console.log('Registration attempt');
            });
        });

    </script>
</body>
</html>